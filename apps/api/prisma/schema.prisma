generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id                 String               @id @default(cuid())
  name               String
  email              String               @unique
  password           String
  createdAt          DateTime             @default(now())
  updatedAt          DateTime             @updatedAt
  lists              Lists[]
  vocabularyProgress VocabularyProgress[]

  CardParam CardParam[]
}

model Vocabulary {
  id                     String                   @id @default(cuid())
  name                   String
  translation            String
  pronunciation          String?
  type                   Type                     @default(WORD)
  provenance             String?
  createdAt              DateTime                 @default(now())
  updatedAt              DateTime                 @updatedAt
  VocabularyList         VocabularyList[]
  VocabularyToCategories VocabularyToCategories[]
  VocabularyProgress     VocabularyProgress[]
}

model Lists {
  id             String           @id @default(cuid())
  name           String
  description    String
  createdAt      DateTime         @default(now())
  updatedAt      DateTime         @updatedAt
  user           User             @relation(fields: [userId], references: [id])
  userId         String
  vocabularyItems VocabularyList[] @relation("ListToVocabulary")
}

model Categories {
  id                     String                   @id @default(cuid())
  name                   String
  createdAt              DateTime                 @default(now())
  updatedAt              DateTime                 @updatedAt
  VocabularyToCategories VocabularyToCategories[]
}

// model VocabularyProgress {
//   id           String     @id @default(cuid())
//   score        Int        @default(0)
//   lastReview   DateTime?
//   reviewNumber Int        @default(0)
//   user         User       @relation(fields: [userId], references: [id])
//   userId       String
//   vocabulary   Vocabulary @relation(fields: [vocabularyId], references: [id])
//   vocabularyId String
//   createdAt    DateTime   @default(now())
//   updatedAt    DateTime   @updatedAt

//   @@unique([userId, vocabularyId])
// }
model VocabularyProgress {
  id           String                      @id @default(cuid())
  score        Int                         @default(0)
  lastReview   DateTime?
  reviewNumber Int                         @default(0)
  user         User                        @relation(fields: [userId], references: [id])
  userId       String
  vocabulary   Vocabulary                  @relation(fields: [vocabularyId], references: [id])
  vocabularyId String
  createdAt    DateTime                    @default(now())
  updatedAt    DateTime                    @updatedAt
  history      VocabularyProgressHistory[]

  @@unique([userId, vocabularyId])
}

model VocabularyProgressHistory {
  id           String             @id @default(cuid())
  progressId   String
  progress     VocabularyProgress @relation(fields: [progressId], references: [id])
  score        Int
  lastReview   DateTime?
  reviewNumber Int
  changedBy    String
  changeType   String
  changedAt    DateTime           @default(now())
}

model VocabularyList {
  id           String     @id @default(cuid())
  vocabulary   Vocabulary @relation(fields: [vocabularyId], references: [id])
  vocabularyId String
  list         Lists      @relation("ListToVocabulary", fields: [listId], references: [id], onDelete: Cascade)
  listId       String
  order        Int
  review       Boolean    @default(false)
  createdAt    DateTime   @default(now())
  updatedAt    DateTime   @updatedAt

  @@unique([listId, vocabularyId])
}

model VocabularyToCategories {
  vocabulary   Vocabulary @relation(fields: [vocabularyId], references: [id])
  vocabularyId String
  category     Categories @relation(fields: [categoryId], references: [id])
  categoryId   String
  createdAt    DateTime   @default(now())
  updatedAt    DateTime   @updatedAt

  @@unique([vocabularyId, categoryId])
}

model CardParam {
  id                 String   @id @default(cuid())
  user               User     @relation(fields: [userId], references: [id])
  userId             String
  random             Boolean  @default(false)
  translationOnVerso Boolean  @default(false)
  createdAt          DateTime @default(now())
  updatedAt          DateTime @updatedAt
}

enum Type {
  WORD
  EXPRESSION
}
