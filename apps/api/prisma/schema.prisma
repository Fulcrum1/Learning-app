generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Language {
  id        String   @id @default(cuid())
  code      String   @unique
  name      String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  vocabulariesSource  Vocabulary[]         @relation("SourceLanguage")
  vocabulariesTarget  Vocabulary[]         @relation("TargetLanguage")
  userSourceLanguage  User[]               @relation("UserSourceLanguage")
  userTargetLanguages UserTargetLanguage[]
}

model User {
  id       String @id @default(cuid())
  name     String
  email    String @unique
  password String

  sourceLanguageId String
  sourceLanguage   Language @relation("UserSourceLanguage", fields: [sourceLanguageId], references: [id])

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  lists              Lists[]
  vocabularyProgress VocabularyProgress[]
  cardParam          CardParam[]
  targetLanguages    UserTargetLanguage[]
}

model UserTargetLanguage {
  id         String   @id @default(cuid())
  userId     String
  user       User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  languageId String
  language   Language @relation(fields: [languageId], references: [id])
  createdAt  DateTime @default(now())

  @@unique([userId, languageId])
}

model Vocabulary {
  id String @id @default(cuid())

  name String
  translation String

  pronunciation String?
  provenance    String?

  // Languages
  sourceLanguageId String
  sourceLanguage   Language @relation("SourceLanguage", fields: [sourceLanguageId], references: [id])

  targetLanguageId String
  targetLanguage   Language @relation("TargetLanguage", fields: [targetLanguageId], references: [id])

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  vocabularyList         VocabularyList[]
  vocabularyToCategories VocabularyToCategories[]
  vocabularyProgress     VocabularyProgress[]

  @@index([sourceLanguageId])
  @@index([targetLanguageId])
}

model Lists {
  id          String   @id @default(cuid())
  name        String
  description String
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  user            User             @relation(fields: [userId], references: [id])
  userId          String
  vocabularyItems VocabularyList[] @relation("ListToVocabulary")
}

model Categories {
  id                     String                   @id @default(cuid())
  name                   String
  createdAt              DateTime                 @default(now())
  updatedAt              DateTime                 @updatedAt
  vocabularyToCategories VocabularyToCategories[]
}

model VocabularyProgress {
  id           String    @id @default(cuid())
  score        Int       @default(0)
  lastReview   DateTime?
  reviewNumber Int       @default(0)

  user         User       @relation(fields: [userId], references: [id])
  userId       String
  vocabulary   Vocabulary @relation(fields: [vocabularyId], references: [id])
  vocabularyId String

  createdAt DateTime                    @default(now())
  updatedAt DateTime                    @updatedAt
  history   VocabularyProgressHistory[]

  @@unique([userId, vocabularyId])
}

model VocabularyProgressHistory {
  id           String             @id @default(cuid())
  progressId   String
  progress     VocabularyProgress @relation(fields: [progressId], references: [id])
  score        Int
  lastReview   DateTime?
  reviewNumber Int
  changedBy    String
  changeType   String
  changedAt    DateTime           @default(now())
}

model VocabularyList {
  id           String     @id @default(cuid())
  vocabulary   Vocabulary @relation(fields: [vocabularyId], references: [id])
  vocabularyId String
  list         Lists      @relation("ListToVocabulary", fields: [listId], references: [id], onDelete: Cascade)
  listId       String
  order        Int
  review       Boolean    @default(false)
  createdAt    DateTime   @default(now())
  updatedAt    DateTime   @updatedAt

  @@unique([listId, vocabularyId])
}

model VocabularyToCategories {
  vocabulary   Vocabulary @relation(fields: [vocabularyId], references: [id])
  vocabularyId String
  category     Categories @relation(fields: [categoryId], references: [id])
  categoryId   String
  createdAt    DateTime   @default(now())
  updatedAt    DateTime   @updatedAt

  @@unique([vocabularyId, categoryId])
}

model CardParam {
  id                 String   @id @default(cuid())
  user               User     @relation(fields: [userId], references: [id])
  userId             String
  random             Boolean  @default(false)
  translationOnVerso Boolean  @default(false)
  createdAt          DateTime @default(now())
  updatedAt          DateTime @updatedAt
}